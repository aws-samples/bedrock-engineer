# Amazon Bedrock 統合

Bedrock EngineerのエージェントチャットはAmazon Bedrockサービスと深く統合されており、様々な強力なAI機能を提供します。このドキュメントでは、利用可能なさまざまなBedrock統合ツールについて詳細に説明します。

## 利用可能なBedrock統合ツール

### generateImage

Amazon Bedrock LLMを使用して画像を生成します。

**機能**：
- デフォルトでstability.sd3-5-large-v1:0を使用
- Stability.aiモデルとAmazonモデルの両方をサポート
- Titanモデル用の特定のアスペクト比とサイズをサポート
- PNG、JPEG、WebP形式で画像を出力
- 決定論的な生成のためのシード値の指定が可能
- 特定の要素を除外するためのネガティブプロンプトをサポート

**ユースケース例**：
- UIモックアップとデザインコンセプトの生成
- ドキュメント用の図解やイラストの作成
- テキストで説明された概念の視覚化
- プロジェクト用のカスタム画像の作成

### recognizeImage

Amazon Bedrockの画像認識機能を使用して画像を分析します。

**分析タイプ**：
- 物体検出
- テキスト検出
- シーン理解
- 画像キャプション生成

**機能**：
- ローカルファイルの画像を処理
- 詳細な分析結果を提供
- コンテンツモデレーションに使用可能
- アクセシビリティ機能の強化
- 自動タグ付けをサポート
- ビジュアル検索アプリケーションを可能に

### generateVideo

Amazon Nova Reelを使用して動画を生成します。

**機能**：
- テキストプロンプトや画像から現実的でスタジオ品質の動画を作成
- 複数のモードをサポート：
  - TEXT_VIDEO（6秒）
  - MULTI_SHOT_AUTOMATED（12-120秒）
  - MULTI_SHOT_MANUAL
- ステータス追跡のためのジョブARNを即座に返す
- S3の設定が必要

### checkVideoStatus

動画生成ジョブのステータスを確認します。

**機能**：
- 実行ARNを使用してステータスを取得
- 現在のステータス、完了時刻、S3の場所を返す
- 動画生成ジョブの進行状況を監視
- 動画がダウンロード可能になったタイミングを判断

### downloadVideo

完成した動画をS3からダウンロードします。

**機能**：
- 実行ARNを使用して動画を識別
- ジョブステータスからS3の場所を自動的に取得
- 指定されたローカルパスまたはプロジェクトディレクトリにダウンロード
- checkVideoStatusでステータスが「Completed」と表示された場合にのみ使用する必要がある

### retrieve

Amazon Bedrock Knowledge Baseを使用して情報を検索します。

**機能**：
- 指定されたナレッジベースから関連情報を取得
- ドメイン固有の知識でエージェントの応答を強化
- 複数のナレッジベースソースをサポート
- 取得した情報のソース属性を提供

### invokeBedrockAgent

指定されたAmazon Bedrock Agentと対話します。

**機能**：
- エージェントIDとエイリアスIDを使用して対話を開始
- 会話の継続性のためにセッションIDを使用
- 様々なユースケースのためのファイル分析機能を提供
- Pythonコード分析をサポート
- 特殊なエージェントとのチャット機能を可能に

### invokeFlow

カスタムデータ処理パイプラインのためにAmazon Bedrock Flowsを実行します。

**機能**：
- エージェント固有のフロー設定をサポート
- 複数の入力データ型を処理：
  - 文字列
  - 数値
  - 真偽値
  - オブジェクト
  - 配列
- 複雑なワークフローの自動化を可能に
- カスタマイズされたデータ処理シーケンスを許可
- 柔軟な入出力処理を提供
- データ変換と多段階処理に最適
- 他のAWSサービスと統合

## 設定要件

Bedrock統合ツールを使用するには、以下が必要です：

### AWS認証情報

- 適切な権限を持つ有効なAWS認証情報
- AWSアカウントでのAmazon Bedrockサービスへのアクセス
- Bedrockアクセス用に設定されたIAMロール

### サービス固有の要件

- **画像/動画生成**：Bedrockの適切なモデルアクセス
- **Knowledge Base**：Amazon Bedrockで事前設定されたナレッジベース
- **Bedrock Agents**：適切なエイリアスを持つ適切に設定されたエージェント
- **Flows**：アカウントで設定されたフロー定義

### ストレージ設定

- 動画生成と保存用のS3バケット設定
- S3アクセスのための適切な権限

## ベストプラクティス

### コスト管理

- 生成機能（画像/動画）の使用状況を監視
- ニーズに適したモデルサイズを使用
- 関連するタスクをバッチ処理することを検討
- 異なるモデルタイプの価格に注意

### パフォーマンス最適化

- 関連情報でナレッジベースを事前設定
- 画像と動画の生成には具体的で明確なプロンプトを使用
- 一貫した結果を得るためにフロー入力を適切に構造化
- 複数のサービスを連携させる場合は応答時間を考慮

### セキュリティ上の考慮事項

- 認証情報管理についてAWSのベストプラクティスに従う
- 必要なサービスのみに権限を制限
- 外部モデルと共有する情報に注意
- ユースケースに関するデータ所在地要件を検討

## 統合例

### 知識強化エージェント

`retrieve`とエージェントの対話を組み合わせることで、独自のナレッジベースにアクセスできるドメイン固有のアシスタントを作成できます。

### ビジュアルコンテンツ作成ワークフロー

完全なワークフローには以下が含まれる場合があります：
1. エージェントを使用して画像のコンセプトを生成
2. `generateImage`で画像を生成
3. `recognizeImage`で結果を分析
4. `generateVideo`で動画アニメーションを作成
5. 動画をダウンロードしてプロジェクトに組み込む

### エージェンティックRAGアプリケーション

以下によって検索拡張生成（RAG）アプリケーションを構築：
1. ドメイン固有のデータでナレッジベースを作成
2. `retrieve`を使用して関連情報にアクセス
3. その情報を文脈に合わせて処理して提示

## トラブルシューティング

一般的な問題と解決策：

- **アクセス拒否**：BedrockサービスのIAM権限を確認
- **モデルが利用できない**：リージョンでのモデルの利用可能性を確認
- **生成の失敗**：プロンプトを改良し、コンテンツポリシー違反がないか確認
- **ナレッジベースの問題**：ナレッジベースが適切にインデックス付けされアクセス可能であることを確認

## 関連ドキュメント

- [Amazon Bedrockドキュメント](https://docs.aws.amazon.com/bedrock/)
- [Agent Preparation Toolkit (APT)](https://github.com/aws-samples/agent-preparation-toolkit)
- [MCPクライアント統合](../advanced-features/mcp-integration-ja.md)