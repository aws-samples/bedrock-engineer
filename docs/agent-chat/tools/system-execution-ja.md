# システムコマンド & コード実行

エージェントチャットは、システムコマンドの実行とコードの実行のための強力なツールを提供します。これらのツールは、エージェントの機能を会話の範囲を超えて拡張し、オペレーティングシステムとの対話やさまざまなプログラミング言語の実行を可能にします。

## 利用可能なシステム & コード実行ツール

### executeCommand

コマンドの実行とプロセス入力の処理を管理します。

**操作モード**：
1. **新規プロセスの開始**：コマンドと作業ディレクトリの指定で新しいプロセスを開始
2. **既存プロセスへの入力**：プロセスIDを使用して既存のプロセスに標準入力を送信

**セキュリティ機能**：
- 許可されたコマンドのみ実行可能
- 設定されたシェルを使用
- 登録されていないコマンドは実行できない

**拡張機能**：
エージェントの機能は、以下のようなコマンドを登録することで拡張できます：
- データベースに接続する
- APIを実行する
- 他のAIエージェントを呼び出す

**設定オプション**：
- 許可コマンドのホワイトリスト
- デフォルトの作業ディレクトリ
- コマンドタイムアウト設定
- シェルの選択

### codeInterpreter

事前にインストールされたデータサイエンスライブラリを持つ安全なDocker環境でPythonコードを実行します。

**主な機能**：
- セキュリティのためのインターネットアクセスなしの隔離されたコード実行
- 事前インストールされたデータサイエンスライブラリ
- 入力ファイルを/data/ディレクトリに読み取り専用でマウント可能
- 生成されたファイルは自動的に検出されレポートされる

**サポートされている環境**：
1. **Basic**：基本的なライブラリを含む：
   - numpy
   - pandas
   - matplotlib
   - requests

2. **Datascience**：完全なMLスタックを含む：
   - scikit-learn
   - scipy
   - seaborn
   - tensorflow
   - pytorch
   - その他

**ユースケース**：
- データ分析と可視化
- 機械学習の実験
- ファイル形式の変換
- カスタムデータ処理

### screenCapture

現在の画面をキャプチャしてPNG画像ファイルとして保存します。

**機能**：
- 現在の表示の画面キャプチャを作成
- オプションでAIビジョンモデル（Claude/Nova）を使用してキャプチャした画像を分析
- スクリーンショットからテキストコンテンツを抽出
- UI要素を識別
- 詳細な視覚的説明を提供
- デバッグとドキュメントをサポート

**要件**：
- プラットフォーム固有の権限が必要
- macOSの場合：システム環境設定でScreen Recording権限が必要

### cameraCapture

HTML5 getUserMedia APIを使用してPCカメラから画像をキャプチャします。

**機能**：
- キャプチャした画像をファイルとして保存
- 異なる品質設定（低、中、高）をサポート
- 異なる形式（JPG、PNG）で出力
- オプションでキャプチャした画像のAI分析
- テキストコンテンツの抽出
- オブジェクト識別
- 詳細な視覚的説明

**要件**：
- ブラウザ設定でカメラアクセス権限
- 互換性のあるウェブカムハードウェア

## セキュリティ上の考慮事項

システムおよびコード実行ツールを使用する際：

### 権限管理

- システムコマンド実行に適切な権限を設定
- 実行可能なコマンドを制限
- 最小権限の原則を使用

### 隔離

- コードインタプリタは隔離されたコンテナで実行
- コード実行環境からのインターネットアクセスなし
- マウントされたファイルへの読み取り専用アクセス

### コンテンツ検証

- 実行前にコードを検証・確認
- システム状態を変更するコマンドには注意
- ユーザー入力のセキュリティへの影響を考慮

## ベストプラクティス

### コマンド実行

- 広範なスクリプトよりも特定の対象を絞ったコマンドを使用
- 明確な作業ディレクトリのコンテキストを提供
- コマンド出力を適切に処理
- 長時間実行コマンドのタイムアウト設定を検討

### コードインタプリタ

- 明確さとエラー処理のためにコードを構造化
- 要件に基づいて適切な環境を使用
- デバッグを容易にするためにコードをモジュール化
- コードの目的と機能を文書化

### 画像キャプチャ

- 適切な権限が付与されていることを確認
- 画面やカメラの画像をキャプチャする際はプライバシーに配慮
- 必要最低限の品質設定を使用

## ユースケース

### データ分析ワークフロー

1. ファイルシステムツールを使用してデータファイルにアクセス
2. codeInterpreterでコードを実行してデータを分析・可視化
3. レポートを生成し結果をエクスポート

### 開発支援

1. screenCaptureでエラーメッセージを表示する画面をキャプチャ
2. エージェントにエラーを分析させる
3. executeCommandを使用して問題を修正するコマンドを実行
4. 追加のコマンドで結果を確認

### システム自動化

1. writeToFileを使用してスクリプトを作成
2. executeCommandを使用してスクリプトを実行
3. 結果をキャプチャして分析
4. 自動化を反復して改善

## トラブルシューティング

一般的な問題と解決策：

- **権限拒否**：システム権限と許可コマンドリストを確認
- **コマンドが見つからない**：コマンドがインストールされており、PATHにあることを確認
- **実行タイムアウト**：長時間実行操作のタイムアウト設定を調整
- **メモリ制限**：コード実行におけるリソース使用に注意

## 機能の拡張

システム実行機能は以下によって拡張できます：

- 追加の許可コマンドを登録
- 複雑な操作用のラッパースクリプトの作成
- コマンドラインツールを通じたAPIアクセスの設定
- 特定のユースケース用の専用環境の設定