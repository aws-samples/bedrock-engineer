# リリースガイド

このドキュメントでは、Bedrock Engineerのリリース方法について説明します。タグベースの自動リリースフローにより、リリース作業が大幅に効率化されています。

## タグベースのリリースフロー

### 1. **タグの作成とプッシュのみでリリース開始**

```bash
# 最新のmainブランチから開始
git checkout main
git pull

# リリース用タグを作成
git tag vX.Y.Z

# タグをプッシュしてリリースプロセスを開始
git push origin vX.Y.Z
```

### 2. **自動リリースプロセス**

タグをプッシュすると、以下が自動的に実行されます：

1. **バージョン更新**：
   - `package.json` と `package-lock.json` のバージョンが自動更新
   - README.md と README-ja.md のバージョン参照が自動更新

2. **リリースブランチ作成**：
   - `release/vX.Y.Z` ブランチが自動生成

3. **ビルドとドラフトリリース**：
   - Mac版とWindows版のビルドが実行
   - ビルド成果物が添付されたドラフトリリースが生成

4. **プルリクエスト作成**：
   - リリース用PRが自動生成

### 3. **レビューとマージ**

1. 自動生成されたPRをレビュー
2. [Actionsタブ](https://github.com/aws-samples/bedrock-engineer/actions)でビルドの完了を確認
3. [Releasesページ](https://github.com/aws-samples/bedrock-engineer/releases)でドラフトリリースを確認
4. ビルド成果物（.dmg、.pkg、.exe）の動作を検証
5. 問題がなければPRをマージ

### 4. **公開**

PRがマージされると自動的に：

- `Publish Release` ワークフローが実行され、ドラフトリリースが公開状態に変更
- [Releasesページ](https://github.com/aws-samples/bedrock-engineer/releases)で公開リリースが確認可能

## トラブルシューティング

### タグプッシュ後にワークフローが実行されない場合：

1. [Actionsタブ](https://github.com/aws-samples/bedrock-engineer/actions)でワークフローの状態を確認
2. エラーがある場合は、ログを確認して対処
3. 必要に応じてタグを削除し、修正後に再度プッシュ：
   ```bash
   git tag -d vX.Y.Z
   git push --delete origin vX.Y.Z
   ```

### バージョン更新に問題がある場合：

1. ワークフローログで更新処理の出力を確認
2. 必要に応じて手動で修正PRを作成

## 補足：従来の手動リリースフロー（参考）

従来は以下の手順で手動リリースを行っていました：

1. `package.json`とREADMEファイルのバージョン手動更新
2. リリースブランチ手動作成
3. PRの手動作成
4. ビルドとドラフトリリース待機
5. マージ後の公開確認

タグベースの自動フローにより、これらの手順が大幅に簡略化されました。

## トラブルシューティング

### ビルドに失敗した場合:

1. GitHub Actionsのログを確認して問題を特定します
2. リリースブランチを修正し、再度プッシュします
3. 問題が解決しない場合は、リリースブランチを削除して最初からやり直すこともできます

### リリースドラフトに問題があり、PRをマージしたくない場合:

1. PRをクローズします（マージせずに）
2. 必要に応じてドラフトリリースを削除:

```bash
gh release delete vX.Y.Z
```

3. 問題を修正し、リリースブランチを更新してプッシュします

### マージ後のリリース公開に失敗した場合:

1. GitHub Actionsのログを確認して問題を特定します
2. 必要に応じて手動でリリースを公開:

```bash
gh release edit vX.Y.Z --draft=false
```

## バージョニング規則

[セマンティックバージョニング](https://semver.org/lang/ja/)に従います：

- **メジャーバージョン (X)**: 互換性のない変更
- **マイナーバージョン (Y)**: 後方互換性のある機能追加
- **パッチバージョン (Z)**: 後方互換性のあるバグ修正
